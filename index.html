<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STREETOLOGY | EST. 2025</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: { black: '#050505', dark: '#0a0a0a', gray: '#121212', accent: '#FF3333' }
                    }
                }
            }
        }
    </script>
    
    <style>
        body { background-color: #050505; color: #ededed; overflow-x: hidden; font-family: sans-serif; }
        .glass-panel { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.05); }
        .glass-nav { background: rgba(5, 5, 5, 0.85); backdrop-filter: blur(15px); border-bottom: 1px solid rgba(255, 255, 255, 0.05); }
        .neon-text { text-shadow: 0 0 30px rgba(255, 255, 255, 0.15); }
        input, select, textarea { background: #0a0a0a; border: 1px solid #222; color: white; border-radius: 0; outline: none; }
        input:focus { border-color: #FF3333; }
        ::-webkit-scrollbar { width: 3px; }
        ::-webkit-scrollbar-thumb { background: #333; }
        .loader-text { animation: pulse 1.5s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
    </style>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getDatabase, ref, push, set, get, remove, update, onValue } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAPzDm1QY2Ag4J_Dw-EJXQiNdjtcRSVB6U",
            authDomain: "streetology-56f7b.firebaseapp.com",
            databaseURL: "https://streetology-56f7b-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "streetology-56f7b",
            storageBucket: "streetology-56f7b.firebasestorage.app",
            messagingSenderId: "762282203847",
            appId: "1:762282203847:web:51626d99a9f98647fdbce2"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);

        window.DB = {
            auth,
            signIn: (e, p) => signInWithEmailAndPassword(auth, e, p),
            signUp: (e, p) => createUserWithEmailAndPassword(auth, e, p),
            subscribeProducts(cb) {
                return onValue(ref(db, 'products'), (s) => {
                    cb(s.exists() ? Object.entries(s.val()).map(([k, v]) => ({...v, _id: k})) : []);
                });
            },
            async getSettings() {
                const s = await get(ref(db, 'settings'));
                return s.exists() ? s.val() : { locked: false, dropTitle: "NEW DROP" };
            },
            async updateSettings(s) { await update(ref(db, 'settings'), s); },
            async createProduct(p) {
                const r = push(ref(db, 'products'));
                await set(r, {...p, _id: r.key, status: 'active'});
            },
            async deleteProduct(id) { await remove(ref(db, `products/${id}`)); },
            async toggleStock(id, cur) {
                await update(ref(db, `products/${id}`), { status: cur === 'sold_out' ? 'active' : 'sold_out' });
            },
            async createOrder(o) {
                const r = push(ref(db, 'orders'));
                await set(r, { ...o, _id: 'ORD-'+r.key.slice(-5).toUpperCase(), status: 'Pending', createdAt: new Date().toLocaleString() });
            },
            async getOrders() {
                const s = await get(ref(db, 'orders'));
                return s.exists() ? Object.entries(s.val()).map(([k, v]) => ({...v, dbKey: k})).reverse() : [];
            },
            async updateOrderStatus(k, s) { await update(ref(db, `orders/${k}`), { status: s }); },
            async getUserOrders(email) {
                const s = await get(ref(db, 'orders'));
                if(!s.exists()) return [];
                return Object.values(s.val()).filter(o => o.userEmail === email).reverse();
            }
        };
        window.dispatchEvent(new Event('db-ready'));
    </script>
</head>
<body>
    <div id="root">
        <div style="height: 100vh; display: flex; align-items: center; justify-content: center; background: #050505; color: white;">
            <div class="loader-text" style="font-weight: 900; letter-spacing: 0.5em; font-size: 14px; text-transform: uppercase;">Streetology</div>
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect, useContext, createContext } = React;
        const { motion, AnimatePresence } = window.Motion;

        const Icon = ({ name, size = 20, className, onClick }) => {
            const icons = {
                ShoppingBag: <svg onClick={onClick} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><path d="M3 6h18"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>,
                User: <svg onClick={onClick} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>,
                X: <svg onClick={onClick} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>,
                Menu: <svg onClick={onClick} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>,
                ArrowLeft: <svg onClick={onClick} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>,
                Box: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/><path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22v-9"/></svg>,
                Trash: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>
            };
            return icons[name] || null;
        };

        const AuthCtx = createContext();
        const CartCtx = createContext();
        const SettingsCtx = createContext();

        const AuthProvider = ({children}) => {
            const [user, setUser] = useState(null);
            const [ready, setReady] = useState(false);

            useEffect(() => {
                const init = () => {
                    if(window.DB?.auth) {
                        return window.DB.auth.onAuthStateChanged(u => {
                            if(u) setUser({ email: u.email, uid: u.uid, role: u.email === 'samimalik67@gmail.com' ? 'admin' : 'user' });
                            else setUser(null);
                            setReady(true);
                        });
                    }
                };
                const unsub = init();
                if(!unsub) window.addEventListener('db-ready', init);
                return () => unsub && unsub();
            }, []);

            return <AuthCtx.Provider value={{user, ready, logout: () => window.DB.auth.signOut()}}>{children}</AuthCtx.Provider>;
        };

        const CartProvider = ({children}) => {
            const [cart, setCart] = useState([]);
            const [open, setOpen] = useState(false);
            const add = (p, s) => { 
                setCart(prev => {
                    const ex = prev.find(i => i._id === p._id && i.size === s);
                    return ex ? prev.map(i => i===ex ? {...i, qty:i.qty+1}:i) : [...prev, {...p, size:s, qty:1}];
                }); 
                setOpen(true); 
            };
            const total = cart.reduce((a, b) => a + (b.price * b.qty), 0);
            return <CartCtx.Provider value={{cart, open, setOpen, add, total, remove: (id, s) => setCart(p => p.filter(i => !(i._id === id && i.size === s))), clear: ()=>setCart([])}}>{children}</CartCtx.Provider>;
        };

        const SettingsProvider = ({children}) => {
            const [settings, setSettings] = useState({locked: false});
            useEffect(() => {
                const f = async () => { if(window.DB) setSettings(await window.DB.getSettings()); };
                f(); window.addEventListener('db-ready', f);
            }, []);
            return <SettingsCtx.Provider value={{settings, updateSettings: (s) => { setSettings(s); window.DB.updateSettings(s); }}}>{children}</SettingsCtx.Provider>
        };

        const Navbar = () => {
            const { cart, setOpen } = useContext(CartCtx);
            const { user } = useContext(AuthCtx);
            const { settings } = useContext(SettingsCtx);
            const [menu, setMenu] = useState(false);
            if(settings.locked && user?.role !== 'admin') return null;
            return (
                <nav className="fixed w-full top-0 z-50 glass-nav h-16 flex items-center justify-between px-6">
                    <div className="flex items-center gap-4">
                        <button onClick={()=>setMenu(true)} className="md:hidden text-white"><Icon name="Menu"/></button>
                        <a href="#home" className="text-xl font-black tracking-tighter italic">STREETOLOGY</a>
                    </div>
                    <div className="hidden md:flex gap-10 text-[10px] font-bold tracking-[0.3em] uppercase">
                        <a href="#home" className="hover:text-brand-accent transition">Home</a>
                        <a href="#shop" className="hover:text-brand-accent transition">Shop</a>
                        <a href="#about" className="hover:text-brand-accent transition">About</a>
                    </div>
                    <div className="flex gap-6 items-center">
                        <a href={user ? (user.role==='admin'?'#admin':'#account') : '#auth'}>
                            <Icon name="User" size={18} className={user?.role==='admin' ? 'text-brand-accent' : ''}/>
                        </a>
                        <div className="relative cursor-pointer" onClick={()=>setOpen(true)}>
                            <Icon name="ShoppingBag" size={18}/>
                            {cart.length > 0 && <span className="absolute -top-2 -right-2 bg-brand-accent text-black text-[9px] w-4 h-4 rounded-full flex items-center justify-center font-bold">{cart.length}</span>}
                        </div>
                    </div>
                    <AnimatePresence>
                        {menu && (
                            <motion.div initial={{x:'-100%'}} animate={{x:0}} exit={{x:'-100%'}} className="fixed inset-0 bg-black z-[60] p-10 flex flex-col uppercase font-black italic">
                                <div className="flex justify-between items-center mb-16">MENU <Icon name="X" onClick={()=>setMenu(false)}/></div>
                                <div className="flex flex-col gap-10 text-4xl tracking-tighter">
                                    <a href="#home" onClick={()=>setMenu(false)}>Home</a>
                                    <a href="#shop" onClick={()=>setMenu(false)}>Shop</a>
                                    <a href="#account" onClick={()=>setMenu(false)}>Account</a>
                                </div>
                            </motion.div>
                        )}
                    </AnimatePresence>
                </nav>
            );
        };

        const Hero = () => {
            const { settings } = useContext(SettingsCtx);
            const { user } = useContext(AuthCtx);
            if(settings.locked && user?.role !== 'admin') {
                return (
                    <div className="h-screen flex flex-col items-center justify-center bg-black px-4 text-center">
                        {settings.dropImage && <img src={settings.dropImage} className="absolute inset-0 w-full h-full object-cover opacity-20 blur-2xl grayscale"/>}
                        <div className="z-10">
                            <h1 className="text-5xl md:text-8xl font-black italic uppercase tracking-tighter mb-4 leading-none">{settings.dropTitle}</h1>
                            <p className="text-brand-accent font-mono tracking-[0.5em] uppercase text-xs">Drop is Restricted</p>
                            <a href="#auth" className="mt-12 inline-block text-[10px] font-bold tracking-widest uppercase border-b border-white/20 pb-1">Admin terminal</a>
                        </div>
                    </div>
                );
            }
            return (
                <div className="h-screen relative flex items-center justify-center bg-black overflow-hidden">
                    <img src="https://images.unsplash.com/photo-1550684848-fac1c5b4e853?q=80&w=2070&auto=format&fit=crop" className="absolute inset-0 w-full h-full object-cover opacity-30 grayscale"/>
                    <div className="z-10 text-center px-4">
                        <div className="relative inline-block mb-4">
                            <motion.h1 initial={{y:30, opacity:0}} animate={{y:0, opacity:1}} className="text-6xl md:text-[10rem] font-black tracking-tighter leading-none neon-text">STREETOLOGY</motion.h1>
                            <div className="absolute -top-4 -right-2 md:-top-8 md:-right-8 border border-white/30 rounded-full w-6 h-6 md:w-12 md:h-12 flex items-center justify-center"><span className="text-[8px] md:text-xs font-bold">TM</span></div>
                            <motion.div initial={{opacity:0}} animate={{opacity:1}} transition={{delay:0.5}} className="absolute -bottom-4 right-0 text-brand-accent font-mono tracking-[0.4em] text-[10px] md:text-xl font-bold uppercase">THE STREETS</motion.div>
                        </div>
                        <p className="mt-16 text-gray-500 font-mono tracking-[0.5em] text-[10px] md:text-xs uppercase">Future Wear // Est. 2025</p>
                        <button onClick={()=>window.location.hash='#shop'} className="mt-10 bg-white text-black px-12 py-4 font-black tracking-widest hover:bg-brand-accent transition uppercase text-xs">Enter Store</button>
                    </div>
                </div>
            );
        };

        const Shop = ({ setCurr }) => {
            const [list, setList] = useState([]);
            const [loading, setLoading] = useState(true);
            useEffect(() => {
                if(window.DB) {
                    const unsub = window.DB.subscribeProducts(data => { setList(data); setLoading(false); });
                    return () => unsub();
                }
            }, []);
            return (
                <div className="pt-24 px-4 md:px-12 pb-20 min-h-screen">
                    <h2 className="text-4xl font-black italic border-b border-white/10 pb-6 mb-12 tracking-tighter uppercase">Collection</h2>
                    {loading ? <div className="py-20 text-center text-xs font-mono tracking-widest text-gray-500 animate-pulse uppercase">Syncing Live Data...</div> : (
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10">
                            {list.map(p => (
                                <div key={p._id} onClick={()=>{ if(p.status!=='sold_out'){ setCurr(p); window.location.hash='#product/'+p._id }}} className={`group cursor-pointer ${p.status==='sold_out'?'opacity-40':''}`}>
                                    <div className="aspect-[3/4] overflow-hidden bg-brand-gray mb-4">
                                        <img src={p.images[0]} loading="lazy" className="w-full h-full object-cover transition duration-700 group-hover:scale-110"/>
                                    </div>
                                    <div className="flex justify-between items-start font-bold uppercase tracking-tighter">
                                        <div><h3 className="text-sm">{p.name}</h3><p className="text-[9px] text-gray-500 tracking-widest mt-1">{p.category}</p></div>
                                        <span className="text-brand-accent font-mono text-sm">₹{p.price}</span>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        const Product = ({ p }) => {
            const { add } = useContext(CartCtx);
            const [size, setSize] = useState('');
            if(!p) return null;
            return (
                <div className="pt-24 px-4 md:px-12 min-h-screen">
                    <button onClick={()=>window.history.back()} className="flex items-center gap-2 text-[10px] font-bold mb-8 uppercase tracking-widest"><Icon name="ArrowLeft" size={12}/> Back</button>
                    <div className="grid md:grid-cols-2 gap-12">
                        <div className="bg-brand-gray aspect-[3/4] border border-white/5"><img src={p.images[0]} className="w-full h-full object-cover"/></div>
                        <div className="flex flex-col justify-center">
                            <h1 className="text-5xl md:text-7xl font-black italic uppercase tracking-tighter mb-4 leading-none">{p.name}</h1>
                            <p className="text-2xl font-mono text-brand-accent font-bold mb-6 italic">₹{p.price}</p>
                            <p className="text-gray-400 text-sm leading-relaxed mb-8 max-w-sm">{p.description}</p>
                            <div className="mb-10 text-[10px] font-bold uppercase tracking-widest">
                                <p className="mb-4">Select Size</p>
                                <div className="flex gap-4">
                                    {['S','M','L','XL'].map(s => (
                                        <button key={s} onClick={()=>setSize(s)} className={`w-12 h-12 border font-bold text-xs transition ${size===s?'bg-white text-black border-white':'border-white/10 text-white hover:border-white'}`}>{s}</button>
                                    ))}
                                </div>
                            </div>
                            <button onClick={()=>size?add(p,size):alert('Select Size')} className="bg-brand-accent text-black font-black py-5 tracking-widest uppercase text-xs hover:bg-white transition">Add To Bag</button>
                        </div>
                    </div>
                </div>
            );
        };

        const Auth = () => {
            const { user } = useContext(AuthCtx);
            const [isLogin, setIsLogin] = useState(true);
            const [f, setF] = useState({ e:'', p:'' });
            const [loading, setLoading] = useState(false);

            if(user) { window.location.hash = user.role === 'admin' ? '#admin' : '#home'; return null; }

            const handleAuth = async (e) => {
                e.preventDefault();
                setLoading(true);
                try {
                    if(isLogin) await window.DB.signIn(f.e, f.p);
                    else await window.DB.signUp(f.e, f.p);
                } catch(err) { alert(err.message); }
                setLoading(false);
            };

            return (
                <div className="h-screen flex items-center justify-center px-4">
                    <div className="glass-panel p-10 w-full max-w-sm">
                        <h2 className="text-3xl font-black italic text-center mb-8 uppercase tracking-tighter">{isLogin?'Login':'Register'}</h2>
                        <form onSubmit={handleAuth} className="space-y-4">
                            <input type="email" placeholder="EMAIL" required className="w-full p-4 text-xs font-bold" value={f.e} onChange={e=>setF({...f, e:e.target.value})}/>
                            <input type="password" placeholder="PASSWORD" required className="w-full p-4 text-xs font-bold" value={f.p} onChange={e=>setF({...f, p:e.target.value})}/>
                            <button disabled={loading} className="w-full bg-brand-accent text-black font-black py-4 uppercase text-xs tracking-widest hover:bg-white transition">{loading ? 'Processing...' : 'Continue'}</button>
                        </form>
                        <p className="text-center text-[10px] text-gray-500 mt-6 cursor-pointer uppercase font-bold tracking-widest" onClick={()=>setIsLogin(!isLogin)}>{isLogin?"Join Streetology":"Login Now"}</p>
                    </div>
                </div>
            );
        };

        const Account = () => {
            const { user, logout } = useContext(AuthCtx);
            const [orders, setOrders] = useState([]);
            useEffect(() => { if(user) window.DB.getUserOrders(user.email).then(setOrders); }, [user]);
            if(!user) return null;
            return (
                <div className="pt-24 px-4 md:px-12 pb-20 max-w-4xl mx-auto min-h-screen uppercase">
                    <div className="flex justify-between items-end mb-16 border-b border-white/10 pb-8 tracking-tighter font-black italic">
                        <div><h1 className="text-5xl">Profile</h1><p className="text-xs font-mono text-gray-500 not-italic tracking-normal mt-2 lowercase">{user.email}</p></div>
                        <button onClick={logout} className="text-brand-accent text-[10px] tracking-widest underline">Logout</button>
                    </div>
                    <div className="space-y-6">
                        <h2 className="text-xl font-bold italic mb-6">Track Bag</h2>
                        {orders.length === 0 ? <p className="text-gray-600 text-[10px] tracking-widest italic">No orders yet.</p> : orders.map(o => (
                            <div key={o._id} className="glass-panel p-6 border-l-2 border-brand-accent">
                                <div className="flex justify-between mb-4 font-bold uppercase"><span className="font-mono text-brand-accent">{o._id}</span><span className="text-[9px] bg-white text-black px-2 py-1 tracking-widest">{o.status}</span></div>
                                <div className="text-xs text-gray-400 space-y-2 font-bold">
                                    {o.items.map((i,idx)=><div key={idx} className="flex justify-between uppercase"><span>{i.name} ({i.size}) x{i.qty}</span><span className="font-mono">₹{i.price*i.qty}</span></div>)}
                                    <div className="border-t border-white/5 mt-4 pt-4 text-white flex justify-between tracking-widest"><span>TOTAL</span><span className="text-brand-accent">₹{o.total}</span></div>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const Admin = () => {
            const { user } = useContext(AuthCtx);
            const { settings, updateSettings } = useContext(SettingsCtx);
            const [tab, setTab] = useState('orders');
            const [orders, setOrders] = useState([]);
            const [prods, setProds] = useState([]);
            const [f, setF] = useState({ name:'', price:'', cat:'Hoodies', desc:'', imgs:[] });

            useEffect(() => {
                if(user?.role === 'admin') {
                    window.DB.getOrders().then(setOrders);
                    window.DB.subscribeProducts(setProds);
                }
            }, [user]);

            if(user?.role !== 'admin') { window.location.hash='#auth'; return null; }

            const addProd = async (e) => {
                e.preventDefault();
                await window.DB.createProduct({ name:f.name, price:Number(f.price), category:f.cat, description:f.desc, images:f.imgs });
                setF({name:'',price:'',cat:'Hoodies',desc:'',imgs:[]}); alert('Broadcasting Success');
            };

            return (
                <div className="pt-24 px-4 md:px-12 pb-20 min-h-screen bg-brand-dark uppercase font-black">
                    <div className="flex justify-between items-center mb-10 border-b border-white/10 pb-6 italic tracking-tighter">
                        <h1 className="text-3xl text-brand-accent">Terminal</h1>
                        <div className="flex gap-6 text-[10px] tracking-widest">
                            {['orders','add','manage','dropzone'].map(t => <button key={t} onClick={()=>setTab(t)} className={tab===t?'text-white border-b-2 border-brand-accent pb-1':'text-gray-600'}>{t}</button>)}
                        </div>
                    </div>
                    {tab==='add' && (
                        <form onSubmit={addProd} className="max-w-xl space-y-4">
                            <input required placeholder="ITEM NAME" className="w-full p-4 text-xs font-bold" value={f.name} onChange={e=>setF({...f, name:e.target.value})}/>
                            <div className="grid grid-cols-2 gap-4">
                                <input required type="number" placeholder="PRICE" className="w-full p-4 text-xs font-bold" value={f.price} onChange={e=>setF({...f, price:e.target.value})}/>
                                <select className="w-full p-4 text-xs font-bold" value={f.cat} onChange={e=>setF({...f, cat:e.target.value})}><option>Hoodies</option><option>Tees</option><option>Pants</option></select>
                            </div>
                            <textarea placeholder="ITEM DESCRIPTION" className="w-full p-4 text-xs font-bold" rows="3" value={f.desc} onChange={e=>setF({...f, desc:e.target.value})}></textarea>
                            <input type="file" onChange={e => { const rd = new FileReader(); rd.onload = () => setF({...f, imgs: [rd.result]}); rd.readAsDataURL(e.target.files[0]); }} className="text-[10px]"/>
                            <button className="w-full bg-white text-black font-black py-4 uppercase tracking-widest text-xs">Push To Production</button>
                        </form>
                    )}
                    {tab==='orders' && (
                        <div className="space-y-4">
                            {orders.map(o => (
                                <div key={o.dbKey} className="glass-panel p-6 flex justify-between items-center italic">
                                    <div><p className="font-mono text-brand-accent text-lg leading-none">{o._id}</p><p className="text-[9px] text-gray-500 mt-1 not-italic font-normal">{o.userEmail}</p></div>
                                    <select value={o.status} onChange={e=>window.DB.updateOrderStatus(o.dbKey, e.target.value)} className="bg-black text-[10px] font-bold p-2 uppercase border border-white/10"><option>Pending</option><option>Shipped</option><option>Delivered</option></select>
                                </div>
                            ))}
                        </div>
                    )}
                    {tab==='manage' && (
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            {prods.map(p => (
                                <div key={p._id} className="glass-panel p-4 flex items-center justify-between">
                                    <div className="flex items-center gap-4 text-[10px] tracking-tight"><img src={p.images[0]} className="w-12 h-12 object-cover border border-white/5"/><span className="italic">{p.name}</span></div>
                                    <div className="flex gap-4">
                                        <button onClick={()=>window.DB.toggleStock(p._id, p.status)} className={p.status==='sold_out'?'text-red-500':'text-green-500'}><Icon name="Box" size={18}/></button>
                                        <button onClick={()=>window.DB.deleteProduct(p._id)} className="text-gray-500 hover:text-red-500"><Icon name="Trash" size={18}/></button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                    {tab==='dropzone' && (
                        <div className="max-w-xl space-y-6">
                            <button onClick={()=>updateSettings({...settings, locked: !settings.locked})} className={`w-full py-5 font-black uppercase text-[10px] tracking-widest text-black transition ${settings.locked?'bg-red-500':'bg-green-500'}`}>{settings.locked?'Store is LOCKED':'Store is OPEN'}</button>
                            <input placeholder="DROP TITLE" className="w-full p-4 text-xs font-bold" value={settings.dropTitle} onChange={e=>updateSettings({...settings, dropTitle: e.target.value})}/>
                        </div>
                    )}
                </div>
            );
        };

        const App = () => {
            const [view, setView] = useState('home');
            const [curr, setCurr] = useState(null);
            const { ready } = useContext(AuthCtx);
            const { cart, total, clear } = useContext(CartCtx);
            const { user } = useContext(AuthCtx);
            const [f, setF] = useState({ addr:'', city:'', zip:'' });

            useEffect(() => {
                const h = () => {
                    const hash = window.location.hash.slice(1) || 'home';
                    if(hash.includes('product/')) setView('product');
                    else setView(hash);
                };
                window.addEventListener('hashchange', h); h();
            }, []);

            if(!ready) return (
                <div style={{height: '100vh', display: 'flex', alignItems: 'center', justify-content: 'center', background: '#050505', color: 'white'}}>
                    <div className="loader-text" style={{fontWeight: 900, letterSpacing: '0.5em', fontSize: '14px', textTransform: 'uppercase'}}>Streetology</div>
                </div>
            );

            return (
                <>
                    <Navbar/>
                    <AnimatePresence mode="wait">
                        {view === 'home' && <Hero key="h"/>}
                        {view === 'shop' && <Shop key="s" setCurr={setCurr}/>}
                        {view === 'product' && <Product key="p" p={curr}/>}
                        {view === 'auth' && <Auth key="a"/>}
                        {view === 'account' && <Account key="ac"/>}
                        {view === 'admin' && <Admin key="ad"/>}
                        {view === 'checkout' && (
                            <div className="pt-24 px-4 md:px-12 pb-20 max-w-5xl mx-auto grid md:grid-cols-2 gap-16 uppercase font-black italic">
                                <form onSubmit={async(e)=>{e.preventDefault(); await window.DB.createOrder({items:cart, total, userEmail:user.email, shipping:f}); clear(); window.location.hash='#success';}} className="space-y-6">
                                    <h2 className="text-4xl tracking-tighter">Shipping</h2>
                                    <input required placeholder="ADDRESS" className="w-full p-4 text-xs font-bold" onChange={e=>setF({...f, addr:e.target.value})}/>
                                    <div className="grid grid-cols-2 gap-4"><input required placeholder="CITY" className="w-full p-4 text-xs font-bold uppercase" onChange={e=>setF({...f, city:e.target.value})}/><input required placeholder="ZIP" className="w-full p-4 text-xs font-bold" onChange={e=>setF({...f, zip:e.target.value})}/></div>
                                    <p className="text-[9px] text-brand-accent tracking-widest italic border border-brand-accent/20 p-4 bg-brand-accent/5">Cash On Delivery Available</p>
                                    <button className="w-full bg-white text-black py-5 tracking-widest text-[10px] hover:bg-brand-accent hover:text-white transition">Place Order Now</button>
                                </form>
                                <div className="glass-panel p-8 h-fit">
                                    <h3 className="text-[10px] text-gray-500 uppercase italic mb-8 border-b border-white/5 pb-2">Bag Summary</h3>
                                    <div className="space-y-4">{cart.map((i,idx)=><div key={idx} className="flex justify-between text-xs tracking-tighter"><span>{i.name} ({i.size}) x{i.qty}</span><span className="font-mono text-brand-accent">₹{i.price*i.qty}</span></div>)}</div>
                                    <div className="border-t border-white/10 mt-8 pt-8 flex justify-between text-3xl tracking-tighter"><span>TOTAL</span><span>₹{total}</span></div>
                                </div>
                            </div>
                        )}
                        {view === 'success' && <div className="h-screen flex flex-col items-center justify-center uppercase font-black italic"><h1 className="text-5xl md:text-7xl mb-4 tracking-tighter text-center">Bag Secured</h1><a href="#account" className="text-brand-accent tracking-widest text-[10px] underline mt-4 uppercase not-italic">Track Order</a></div>}
                        {view === 'about' && <div className="pt-32 text-center max-w-2xl mx-auto px-4 uppercase font-black italic tracking-tighter leading-none"><h1 className="text-4xl mb-6">MANIFESTO</h1><p className="text-gray-500 tracking-[0.2em] text-[10px] leading-relaxed">Born in 2025 to redefine the future of luxury streetwear. Quality. Identity. Future. Streetology.</p></div>}
                    </AnimatePresence>
                    <CartSidebar/>
                </>
            );
        };

        const CartSidebar = () => {
            const { cart, open, setOpen, remove, total } = useContext(CartCtx);
            return (
                <AnimatePresence>
                    {open && (
                        <>
                            <motion.div initial={{opacity:0}} animate={{opacity:1}} exit={{opacity:0}} onClick={()=>setOpen(false)} className="fixed inset-0 bg-black/90 z-[60] backdrop-blur-md"/>
                            <motion.div initial={{x:'100%'}} animate={{x:0}} exit={{x:'100%'}} className="fixed right-0 top-0 h-full w-full md:w-[450px] bg-brand-black z-[70] border-l border-white/5 flex flex-col shadow-2xl">
                                <div className="p-8 flex justify-between items-center font-black italic tracking-widest uppercase border-b border-white/5 text-sm">Bag <Icon name="X" className="cursor-pointer" onClick={()=>setOpen(false)}/></div>
                                <div className="flex-1 overflow-y-auto p-8 space-y-6">
                                    {cart.map((i,idx) => (
                                        <div key={idx} className="flex gap-6 glass-panel p-4 items-center uppercase font-bold tracking-tighter">
                                            <div className="w-20 h-24 bg-brand-gray flex-shrink-0 border border-white/5"><img src={i.images[0]} className="w-full h-full object-cover"/></div>
                                            <div className="flex-1 min-w-0">
                                                <div className="flex justify-between text-[10px]"><span>{i.name}</span><span className="font-mono text-brand-accent">₹{i.price*i.qty}</span></div>
                                                <p className="text-[10px] text-gray-500 mt-1">{i.size} | Qty: {i.qty}</p>
                                                <button onClick={()=>remove(i._id, i.size)} className="text-[10px] text-red-500 font-bold mt-4 tracking-[0.2em] underline italic">Remove</button>
                                            </div>
                                        </div>
                                    ))}
                                    {!cart.length && <div className="text-center text-gray-700 mt-20 uppercase tracking-[0.3em] text-[9px] font-black italic">Bag Empty</div>}
                                </div>
                                {cart.length > 0 && <div className="p-8 border-t border-white/5"><button onClick={()=>{setOpen(false); window.location.hash='#checkout'}} className="w-full bg-white text-black py-5 font-black uppercase text-[10px] tracking-widest hover:bg-brand-accent transition">Checkout Total - ₹{total}</button></div>}
                            </motion.div>
                        </>
                    )}
                </AnimatePresence>
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(
            <AuthProvider>
                <SettingsProvider>
                    <CartProvider>
                        <App />
                    </CartProvider>
                </SettingsProvider>
            </AuthProvider>
        );
    </script>
</body>
</html>
