<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>STREETOLOGY</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.tailwindcss.com"></script>
<script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<style>
body{background:#050505;color:white;font-family:sans-serif}
</style>
</head>

<body>
<div id="root"></div>

<script type="text/babel">
const {useState,useEffect,useContext,createContext} = React;

/* ================= AUTH CONTEXT ================= */
const AuthCtx = createContext();

const AuthProvider = ({children})=>{
  const [user,setUser] = useState(null);
  const [ready,setReady] = useState(true);

  const login = ()=>{
    setUser({email:'user@test.com'});
  };

  const logout = ()=>{
    setUser(null);
  };

  return (
    <AuthCtx.Provider value={{user,ready,login,logout}}>
      {children}
    </AuthCtx.Provider>
  );
};

/* ================= HERO ================= */
const Hero = ()=>{
  const {user} = useContext(AuthCtx);

  return (
    <div className="h-screen flex items-center justify-center text-center">
      <div>
        <h1 className="text-6xl font-black italic mb-10">STREETOLOGY</h1>

        <button
          onClick={()=>{
            if(!user){
              localStorage.setItem('redirectAfterLogin','#shop');
              window.location.hash='#auth';
            }else{
              window.location.hash='#shop';
            }
          }}
          className="bg-white text-black px-10 py-4 font-black uppercase"
        >
          Enter Store
        </button>
      </div>
    </div>
  );
};

/* ================= AUTH ================= */
const Auth = ()=>{
  const {user,login} = useContext(AuthCtx);

  useEffect(()=>{
    if(user){
      const r = localStorage.getItem('redirectAfterLogin') || '#home';
      localStorage.removeItem('redirectAfterLogin');
      window.location.hash = r;
    }
  },[user]);

  return (
    <div className="h-screen flex items-center justify-center">
      <button
        onClick={login}
        className="bg-white text-black px-10 py-4 font-black uppercase"
      >
        Login Now
      </button>
    </div>
  );
};

/* ================= SHOP ================= */
const Shop = ()=>{
  const {user} = useContext(AuthCtx);

  return (
    <div className="pt-32 text-center space-y-8">
      <h1 className="text-5xl font-black">SHOP</h1>

      <button
        onClick={()=>{
          if(!user){
            localStorage.setItem('redirectAfterLogin','#checkout');
            window.location.hash='#auth';
          }else{
            window.location.hash='#checkout';
          }
        }}
        className="bg-brand-accent bg-white text-black px-8 py-3 font-black uppercase"
      >
        Go To Checkout
      </button>
    </div>
  );
};

/* ================= CHECKOUT ================= */
const Checkout = ()=>{
  const {user} = useContext(AuthCtx);

  if(!user){
    localStorage.setItem('redirectAfterLogin','#checkout');
    window.location.hash='#auth';
    return null;
  }

  return (
    <div className="h-screen flex items-center justify-center">
      <h1 className="text-4xl font-black">CHECKOUT PAGE</h1>
    </div>
  );
};

/* ================= APP ================= */
const App = ()=>{
  const {ready} = useContext(AuthCtx);
  const [view,setView] = useState('home');

  useEffect(()=>{
    const h = ()=>{
      setView(window.location.hash.replace('#','') || 'home');
    };
    window.addEventListener('hashchange',h);
    h();
  },[]);

  if(!ready) return <div>Loadingâ€¦</div>;

  return (
    <>
      {view==='home' && <Hero/>}
      {view==='auth' && <Auth/>}
      {view==='shop' && <Shop/>}
      {view==='checkout' && <Checkout/>}
    </>
  );
};

/* ================= RENDER ================= */
ReactDOM.createRoot(document.getElementById('root')).render(
  <AuthProvider>
    <App/>
  </AuthProvider>
);
</script>
</body>
</html>
